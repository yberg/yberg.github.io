<html><head><link rel="import" href="../app-storage-behavior.html"><link rel="import" href="../../polymer/polymer.html"></head><body><dom-module id="app-localstorage-document"><script>'use strict';Polymer({is:'app-localstorage-document',behaviors:[Polymer.AppStorageBehavior],properties:{key:{type:String,notify:!0},sessionOnly:{type:Boolean,value:!1},storage:{type:Object,computed:'__computeStorage(sessionOnly)'}},observers:['__storageSourceChanged(storage, key)'],attached:function(){this.listen(window,'storage','__onStorage'),this.listen(window.top,'app-local-storage-changed','__onAppLocalStorageChanged')},detached:function(){this.unlisten(window,'storage','__onStorage'),this.unlisten(window.top,'app-local-storage-changed','__onAppLocalStorageChanged')},get isNew(){return!this.key},saveValue:function(a){try{this.__setStorageValue(a,this.data)}catch(a){return Promise.reject(a)}return this.key=a,Promise.resolve()},reset:function(){this.key=null,this.data=this.zeroValue},destroy:function(){try{this.storage.removeItem(this.key),this.reset()}catch(a){return Promise.reject(a)}return Promise.resolve()},getStoredValue:function(a){var b;if(null!=this.key)try{b=this.__parseValueFromStorage(),b=null==b?void 0:this.get(a,{data:b})}catch(a){return Promise.reject(a)}return Promise.resolve(b)},setStoredValue:function(a,b){if(null!=this.key){try{this.__setStorageValue(this.key,this.data)}catch(a){return Promise.reject(a)}this.fire('app-local-storage-changed',this,{node:window.top})}return Promise.resolve(b)},__computeStorage:function(a){return a?window.sessionStorage:window.localStorage},__storageSourceChanged:function(){this._initializeStoredValue()},__onStorage:function(a){a.key!==this.key||a.storageArea!==this.storage||this.syncToMemory(function(){this.set('data',this.__parseValueFromStorage())})},__onAppLocalStorageChanged:function(a){a.detail===this||a.detail.key!==this.key||a.detail.storage!==this.storage||this.syncToMemory(function(){this.set('data',a.detail.data)})},__parseValueFromStorage:function(){try{return JSON.parse(this.storage.getItem(this.key))}catch(a){console.error('Failed to parse value from storage for',this.key)}},__setStorageValue:function(){this.storage.setItem(this.key,JSON.stringify(this.data))}});</script></dom-module></body></html>