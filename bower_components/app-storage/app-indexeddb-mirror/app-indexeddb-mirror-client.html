<html><head><link rel="import" href="common-worker.html"><script>(function(){'use strict';var a='__workerUrl',b='__connectsToWorker',c='__connected',d='__messageId',e='__mirroringSupported';Polymer.AppIndexedDBMirrorClient=function(f){this[a]=f,this[c]=!1,this[d]=0,this[b]=null,this[e]=null,this.connect()},Polymer.AppIndexedDBMirrorClient.prototype={get supportsMirroring(){return this[e]},validateSession:function(a){return void 0===a?void 0:this.post({type:'app-mirror-validate-session',session:a})},post:function(a){return this.connect().then(function(b){return this[e]?new Promise(function(c){var e=this[d]++,f=b.port;f.addEventListener('message',function a(b){b.data&&b.data.id===e&&(f.removeEventListener('message',a),c(b.data.result))}),a.id=e,f.postMessage(a)}.bind(this)):Promise.resolve({})}.bind(this))},transaction:function(a,b,c){return this.post({type:'app-mirror-transaction',method:a,key:b,value:c})},closeDb:function(){return this.post({type:'app-mirror-close-db'})},connect:function(){return this[c]||this[b]?this[b]:(console.log('App IndexedDB Client connecting..'),this[b]=new Promise(function(b){var d=new Polymer.CommonWorker(this[a]);d.port.addEventListener('message',function(a){a.data&&'app-mirror-connected'===a.data.type&&(console.log('App IndexedDB Client connected!'),this[c]=!0,this[e]=a.data.supportsIndexedDB,b(d))}.bind(this)),d.addEventListener('error',function(a){console.error(a.message||a)}),d.port.start(),d.port.postMessage({type:'app-mirror-connect'})}.bind(this)))}}})();</script></head><body></body></html>