<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="firebase-common-behavior.html"><link rel="import" href="firebase-messaging-script.html"></head><body><dom-module id="firebase-messaging"><script>(function(){function a(a,b){var c=Array.prototype.slice.call(arguments,2);d[a.name].instances.forEach(function(a){a[b].apply(a,c)})}function b(b){d[b.name];b.messaging().getToken().then(function(c){return a(b,'_setToken',c),a(b,'_setStatusKnown',!0),c},function(c){throw a(b,'_setToken',null),a(b,'_setStatusKnown',!0),a(b,'fire','error',c),c})}function c(a,c){var e=c.name;d[e]=d[e]||{messaging:c.messaging()};var f=d[e];return f.instances=f.instances||[],0>f.instances.indexOf(a)&&f.instances.push(a),f.listener||(f.listener=c.messaging().onMessage(function(a){f.instances.forEach(function(b){b._setLastMessage(a),b.fire('message',{message:a})})})),f.tokenListener||(f.tokenListener=c.messaging().onTokenRefresh(function(){b(c)})),b(c)}var d={};Polymer({is:'firebase-messaging',behaviors:[Polymer.FirebaseCommonBehavior],properties:{token:{type:String,value:null,notify:!0,readOnly:!0},active:{type:Boolean,notify:!0,computed:'_computeActive(statusKnown, token)'},statusKnown:{type:Boolean,value:!1,notify:!0,readOnly:!0},lastMessage:{type:Object,value:null,notify:!0,readOnly:!0},customSw:{type:Boolean,value:!1},pushSupported:{type:Boolean,value:function(){return'serviceWorker'in navigator&&'PushManager'in window},notify:!0,readOnly:!0}},observers:['_bootstrapApp(app, customSw)'],requestPermission:function(){if(!this.messaging)throw new Error('firebase-messaging: No app configured!');return this.messaging.requestPermission().then(function(){return b(this.app)}.bind(this))},activate:function(a){return this.statusKnown=!1,this.active=!1,this.token=null,this.app?void(this.messaging=this.app.messaging(),a&&this.messaging.useServiceWorker(a),c(this,this.app)):(this.messaging=null,this.statusKnown=!1,this.active=!1,void(this.token=null))},_computeActive:function(a,b){return!!(a&&b)},_bootstrapApp:function(a,b){a&&!b&&this.activate()}})})();</script></dom-module></body></html>