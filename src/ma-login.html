<html><head><link rel="import" href="../bower_components/polymer/polymer-element.html"><link rel="import" href="../bower_components/app-storage/app-localstorage/app-localstorage-document.html"><link rel="import" href="../bower_components/iron-ajax/iron-ajax.html"><link rel="import" href="../bower_components/iron-meta/iron-meta.html"><link rel="import" href="../bower_components/iron-icon/iron-icon.html"><link rel="import" href="../bower_components/paper-input/paper-input.html"><link rel="import" href="../bower_components/paper-button/paper-button.html"><link rel="import" href="ma-storage.html"><link rel="import" href="ma-spinner.html"><link rel="import" href="shared-styles.html"></head><body><dom-module id="ma-login"><template><style include="shared-styles">:host{--paper-button:{background:var(--app-primary-color);color:white;};}.wrapper{@apply --layout-vertical;justify-content:center;align-items:center;height:100%;margin:0 32px;}.wrapper > *{width:100%;margin-top:16px;}</style><iron-meta key="env" value="{{env}}"></iron-meta><app-localstorage-document key="user" data="{{user}}"></app-localstorage-document><app-localstorage-document key="sessionIdentifier" data="{{sessionIdentifier}}"></app-localstorage-document><iron-ajax id="createAccountRequest" url="[[env.apiUrl]]/Client/CreateAccountConfirmedEmail" method="post" content-type="application/x-www-form-urlencoded" handle-as="json" on-response="_handleCreateAccountResponse"></iron-ajax><iron-ajax id="verifyAccountRequest" url="[[env.apiUrl]]/Client/VerifyAccountConfirmedEmail" method="post" content-type="application/x-www-form-urlencoded" handle-as="json" on-response="_handleVerifyAccountResponse"></iron-ajax><iron-ajax id="loginRequest" url="[[env.apiUrl]]/Client/LogOnConfirmedEmail" method="post" content-type="application/x-www-form-urlencoded" handle-as="json" on-response="_handleLoginResponse"></iron-ajax><ma-spinner overlay="" loading="[[loading]]"></ma-spinner><div class="wrapper condense"><h1>Logga in</h1><paper-input id="email" type="email" label="E-postadress" value="{{email}}" auto-validate="" disabled$="[[accountCreated]]"></paper-input><paper-button raised="" on-tap="_createAccount" disabled$="[[accountCreated]]">NÃ¤sta</paper-button><template is="dom-if" if="[[accountCreated]]"><h3>Ange kod</h3><paper-input type="number" label="Kod" value="{{code}}" disabled$="[[accountVerified]]"></paper-input><paper-button raised="" on-tap="_verifyAccount" disabled$="[[accountVerified]]">Logga in</paper-button></template></div></template><script>class MaLogin extends Polymer.Element{static get is(){return'ma-login'}static get properties(){return{accountCreated:Boolean,accountVerified:Boolean,loading:Boolean,sessionIdentifier:{type:String,value:''}}}_initializeUser(){this.user={}}_userLoaded(a){console.log(a),console.log('user',this.user)}_createAccount(){const a=this.$.email;a.value&&a.validate()&&(this.set('loading',!0),this.phoneId=(Math.floor(1e4*Math.random()+1)+'').padStart(4,'0'),this.$.createAccountRequest.body={appId:this.env.appId,email:this.email,phoneId:this.phoneId,firstname:'Viktor',lastname:'Yberg'},this.$.createAccountRequest.generateRequest())}_handleCreateAccountResponse(a){this.set('loading',!1);const b=a.detail.response;b.Success&&this.set('accountCreated',!0)}_verifyAccount(){this.set('loading',!0),this.$.verifyAccountRequest.body={appId:this.env.appId,email:this.email,phoneId:this.phoneId,code:this.code},this.$.verifyAccountRequest.generateRequest()}_handleVerifyAccountResponse(a){this.set('loading',!1);const b=a.detail.response;b.Success&&(this.set('accountVerified',!0),this.login(this.email,b.Password))}login(a,b){this.set('loading',!0),this.$.loginRequest.body={appId:this.env.appId,email:a,phoneId:this.phoneId,password:b},this.$.loginRequest.generateRequest()}_handleLoginResponse(a){this.set('loading',!1);const b=a.detail.response;b.Valid&&(this.set('user.email',this.email),this.set('sessionIdentifier',b.SessionIdentifier),window.history.pushState({},null,'/program'),window.dispatchEvent(new CustomEvent('location-changed')))}}window.customElements.define(MaLogin.is,MaLogin);</script></dom-module></body></html>