<html><head><link rel="import" href="../bower_components/polymer/polymer-element.html"><link rel="import" href="../bower_components/app-storage/app-localstorage/app-localstorage-document.html"><link rel="import" href="../bower_components/iron-meta/iron-meta.html"><link rel="import" href="../bower_components/iron-ajax/iron-ajax.html"><link rel="import" href="../bower_components/polymerfire/firebase-messaging.html"><link rel="import" href="../bower_components/paper-toggle-button/paper-toggle-button.html"><link rel="import" href="../bower_components/paper-button/paper-button.html"><link rel="import" href="../bower_components/paper-spinner/paper-spinner-lite.html"></head><body><dom-module id="ma-subscription"><template><style>:host{height:100px;width:100px;--paper-button:{background:var(--app-primary-color);color:white;};}</style><iron-meta key="env" value="{{env}}"></iron-meta><app-localstorage-document key="auth" data="{{auth}}"></app-localstorage-document><iron-ajax id="pushRequest" url="https://ma-push.herokuapp.com/" method="post" content-type="application/x-www-form-urlencoded" handle-as="json"></iron-ajax><iron-ajax id="registerTokenRequest" url="[[env.apiUrl]]/PushNotification/RegisterWeb" method="post" content-type="application/x-www-form-urlencoded" handle-as="json"></iron-ajax><firebase-messaging id="messaging" token="{{token}}" on-message="_handleMessage"></firebase-messaging><div style="margin: 16px; max-width: 100%"><div style="display: flex"><paper-toggle-button id="subscribe" on-change="_toggleSubscription" checked="[[toggle]]">Till√•t push-notiser</paper-toggle-button><paper-spinner-lite id="spinner" style="margin-left: 16px"></paper-spinner-lite></div><p></p><paper-button raised="" class="pink" on-tap="_notify" disabled$="[[!token]]">Skicka notis</paper-button><p>Token:</p><p style="word-wrap: break-word">[[token]]</p></div></template><script>class MaSubscription extends Polymer.Element{static get is(){return'ma-subscription'}static get properties(){return{token:{type:String,observer:'_tokenChanged'}}}_tokenChanged(a){a&&(this.$.subscribe.active=!0,this.$.subscribe.disabled=!0,this.$.spinner.active=!1,this.$.registerTokenRequest.body={auth:this.auth,uri:a},this.$.registerTokenRequest.generateRequest())}_toggleSubscription(){this.$.spinner.active=!0,this.$.messaging.requestPermission().then(()=>{this.$.subscribe.disabled=!0,console.log('permission granted')},()=>{this.$.subscribe.active=!1,this.$.spinner.active=!1,console.error('permission denied')})}_notify(){this.$.pushRequest.body={token:this.token},this.$.pushRequest.generateRequest()}_handleMessage(a,b){console.log('message received',b),new Notification('Test')}}window.customElements.define(MaSubscription.is,MaSubscription);</script></dom-module></body></html>