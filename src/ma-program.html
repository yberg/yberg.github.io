<html><head><link rel="import" href="../bower_components/polymer/polymer-element.html"><link rel="import" href="../bower_components/iron-ajax/iron-ajax.html"><link rel="import" href="../bower_components/iron-list/iron-list.html"><link rel="import" href="../bower_components/paper-tabs/paper-tabs.html"><link rel="import" href="../bower_components/paper-ripple/paper-ripple.html"><link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html"><link rel="import" href="../bower_components/paper-item/paper-item.html"><link rel="import" href="../bower_components/paper-item/paper-item-body.html"><link rel="import" href="moment.html"><link rel="import" href="ma-header-layout.html"><link rel="import" href="ma-program-data.html"><link rel="import" href="ma-spinner.html"><link rel="import" href="ma-icons.html"><link rel="import" href="shared-styles.html"></head><body><dom-module id="ma-program"><template><style include="shared-styles">:host{--paper-tabs:{background-color:var(--app-primary-color);};--paper-tab:{color:white;};--paper-icon-button:{color:var(--paper-grey-300);};}iron-list{height:calc(100vh - 128px);padding-bottom:16px;}paper-icon-button.active{color:var(--paper-amber-500);}</style><ma-program-data program="{{program}}" loading="{{loading}}"></ma-program-data><ma-spinner loading="[[loading]]"></ma-spinner><ma-header-layout fullbleed="" title="Program" fixed="" shadow=""><paper-tabs slot="toolbar" selected="{{selected}}" scrollable="" fit-container="" class="condense"><paper-tab>Alla</paper-tab><paper-tab>Mitt program</paper-tab></paper-tabs><template is="dom-if" if="[[!_hasProgramItems(program, loading)]]"><div>Programmet Ã¤r tomt</div></template><iron-list items="[[_generateGroups(program.ProgramItems, showAll)]]" as="item" class="condense"><template><div><div class="list-header" hidden$="[[!_hasGroup(index)]]">[[_format(item.StartDate, 'date')]]</div><a href="[[rootPath]]program-item/[[item.Id]]" class="paper-item-link"><paper-item><paper-icon-button icon="ma-icons:star" on-click="_toggleFavorite" class$="[[_getStarClass(item.favorite)]]"></paper-icon-button><paper-item-body two-line=""><div><strong>[[_format(item.StartDate, 'time')]]</strong></div><div secondary="">[[item.Title]]</div></paper-item-body><paper-ripple></paper-ripple></paper-item></a></div></template></iron-list></ma-header-layout></template><script>class MaProgram extends Polymer.Element{static get is(){return'ma-program'}static get properties(){return{program:Object,selected:{type:Number,value:0},showAll:{type:Boolean,computed:'_shouldShowAll(selected)'}}}_openDrawer(){window.dispatchEvent(new CustomEvent('open-drawer'))}_shouldShowAll(a){return 0===a}_generateGroups(a,b){if(console.log('items',a),!a)return;let c=a.map((a)=>a).filter((a)=>!!b||!!a.favorite),d=[];return this._groupIdxMap=c.reduce((a,b,c,e)=>((0==c||this._format(b.StartDate,'date')!==this._format(e[c-1].StartDate,'date'))&&(a[c]=!0,d.push({start:b.StartDate,index:c})),a),{}),this.dates=d,c}_hasGroup(a){return!0===this._groupIdxMap[a]}_isLastInGroup(a){return this._hasGroup(a+1)?'last':''}_hasProgramItems(a,b){return b||!!a&&!!a.ProgramItems&&!!a.ProgramItems.length}_format(a,b){return'date'===b?moment(a).format('dddd, D MMMM YYYY'):'time'===b?moment(a).format('HH:MM'):moment(a)}_toggleFavorite(a){a.preventDefault();let{model:b}=a;b.set('item.favorite',!b.item.favorite)}_getStarClass(a){return a?'active':''}}window.customElements.define(MaProgram.is,MaProgram);</script></dom-module></body></html>