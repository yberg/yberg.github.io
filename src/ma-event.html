<html><head><link rel="import" href="../bower_components/polymer/polymer-element.html"><link rel="import" href="../bower_components/app-route/app-route.html"><link rel="import" href="../bower_components/app-storage/app-localstorage/app-localstorage-document.html"><link rel="import" href="../bower_components/iron-icon/iron-icon.html"><link rel="import" href="../bower_components/iron-ajax/iron-ajax.html"><link rel="import" href="../bower_components/paper-card/paper-card.html"><link rel="import" href="../bower_components/paper-button/paper-button.html"><link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html"><link rel="import" href="idb.html"><link rel="import" href="moment.html"><link rel="import" href="ma-header-layout.html"><link rel="import" href="ma-event-data.html"><link rel="import" href="ma-animations.html"><link rel="import" href="ma-icons.html"><link rel="import" href="shared-styles.html"><link rel="import" href="mixins/ma-moment-mixin.html"></head><body><dom-module id="ma-event"><template><style include="shared-styles">:host{display:flex;flex-direction:column;min-height:calc(100vh - 50px);padding-bottom:50px;--paper-card:{flex:1;margin:8px;};}#activateButton{position:fixed;bottom:0;left:0;width:100%;height:50px;background:var(--app-primary-color);color:white;border-radius:0;margin:0;}#activateButton[disabled]{opacity:0.5;}[main-title]{font-size:24px;margin-left:8px!important;}.description{display:flex;align-items:flex-start;}.description img{width:40%;height:auto;margin:0 16px 16px 0;border-radius:2px;}</style><iron-meta key="env" value="{{env}}"></iron-meta><app-localstorage-document key="auth" data="{{auth}}"></app-localstorage-document><iron-ajax id="activateRequest" url="[[env.apiUrl]]/MobileAuth/ChangeInstance" method="post" content-type="application/x-www-form-urlencoded" handle-as="json" on-response="_handleActivateResponse" loading="{{loading}}"></iron-ajax><app-route route="[[route]]" pattern="/:id" data="{{routeData}}"></app-route><ma-event-data id="[[routeData.id]]" event="{{event}}"></ma-event-data><ma-header-layout title="[[event.Name]]" effects="waterfall resize-title" condenses="" reveals="" back-button="" back-link="events"><div class="condense flex"><paper-card id="card"><div class="card-content"><div class="description"><img src="[[event.ListLogoUrl]]" alt=""> [[event.Description]]</div><strong>[[format(event.StartDate, 'date')]] - [[format(event.EndDate, 'date')]]</strong><br></div></paper-card></div><paper-button id="activateButton" raised="" on-tap="_activate" disabled$="[[loading]]"><iron-icon></iron-icon>Aktivera event<iron-icon icon="ma-icons:chevron-right"></iron-icon></paper-button></ma-header-layout></template><script>class MaEvent extends MaMomentMixin(Polymer.Element){static get is(){return'ma-event'}static get properties(){return{id:String,event:{type:Object,value:()=>({}),observer:'_eventChanged'},events:Array,loading:{type:Boolean,value:!1},user:Object,active:{type:Boolean,observer:'_activeChanged'}}}static get observers(){return['_eventChanged(routeData.id, event)']}_activeChanged(){const{fadeIn:a,fadeInWithDelay:b,slideUp:c}=Animations;this.animate(a.keyframes,a.options),this.$.card.animate(c.keyframes,c.options),this.$.activateButton.animate(b.keyframes,b.options)}_eventChanged(a,b){b&&b.Id===a||!window.history.state||!window.history.state.event||this.set('event',window.history.state.event)}_activate(){this.$.activateRequest.body={applicationInstanceId:this.event.Id,auth:this.auth,code:window.history.state.code},this.$.activateRequest.generateRequest()}_handleActivateResponse(a){const b=a.detail.response;if(console.log('res',b),b.Valid){this.set('auth',b.SessionIdentifier);const a=Object.assign(this.event,{IsCurrent:!0});localStorage.setItem('instanceInfo',JSON.stringify(a)),window.dispatchEvent(new CustomEvent('event-changed',{detail:{event:a}})),window.history.pushState({},null,'/'),window.dispatchEvent(new CustomEvent('location-changed'))}}}window.customElements.define(MaEvent.is,MaEvent);</script></dom-module></body></html>