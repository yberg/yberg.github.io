<html><head><link rel="import" href="../bower_components/polymer/polymer-element.html"></head><body><dom-module id="ma-storage"><script>var maStorage=maStorage||{};class MaStorage extends Polymer.Element{static get is(){return'ma-storage'}static get properties(){return{key:String,value:{type:Object,notify:!0,observer:'_valueChanged'},readonly:{type:Boolean,value:!1}}}connectedCallback(){if(super.connectedCallback(),console.log('key',this.key,maStorage[this.key]),this.key)maStorage[this.key]?this.value!=maStorage[this.key].value&&(this.value=maStorage[this.key].value):maStorage[this.key]={value:this.value,observers:[this],isChanging:!1},this._setObserver(this.key);else throw new Error('Invalid Argument: The `key` property must be defined.')}disconnectedCallback(){super.disconnectedCallback();var a=maStorage[this.key].observers.indexOf(this);-1!==a&&maStorage[this.key].observers.splice(a,1)}_setObserver(a){var b=maStorage[a].observers.indexOf(this);-1===b&&maStorage[a].observers.push(this)}_valueChanged(a,b){console.log(b,'changed to',a),this.readonly||a==b||!maStorage[this.key]||a==maStorage[this.key].value||maStorage[this.key].isChanging||this._setValue(this.key,a)}_setValue(a,b){for(var c in maStorage[a].isChanging=!0,maStorage[a].value=b,maStorage[a].observers)maStorage[a].observers[c]!=this&&maStorage[a].observers[c].set('value',b);console.log('setting',b),window.localStorage.setItem(a,JSON.stringify(b)),maStorage[a].isChanging=!1}}window.customElements.define(MaStorage.is,MaStorage);</script></dom-module></body></html>